<!DOCTYPE html>
<html>
<head>
    <title>Admin Login — Campus Transport</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:#071018; color:#e6eef8; padding:20px }
        .box { max-width:420px; margin:36px auto; background:#0d1117; padding:18px; border-radius:10px; border:1px solid rgba(255,255,255,0.03) }
        h1 { font-size:18px; margin-bottom:6px }
        p { color:#9aa4b2; margin-bottom:12px }
        label { display:block; font-size:13px; color:#9aa4b2; margin-top:8px }
        input { width:100%; padding:10px; border-radius:8px; margin-top:6px; background:#07101a; border:1px solid rgba(255,255,255,0.04); color:#e6eef8 }
        button { margin-top:12px; padding:10px 12px; border-radius:8px; background:#34d399; border:none; color:#042017; cursor:pointer }
        .muted { color:#9aa4b2; font-size:13px; margin-top:8px }
        .note { font-size:12px; color:#8893a6 }
    </style>
</head>
<body>
    <div class="box">
        <h1>{{ institute_name | default('Institute') }} — Admin</h1>
        <p class="muted">Sign in using your admin username and password.</p>

        {% if not credentials_exist %}
        <div class="note">No admin account detected. Fill in details to create the initial admin account.</div>
        {% endif %}


        {% if error_text %}
        <div style="color:#ff5a5a; margin-bottom:10px; font-size:14px;">{{ error_text }}</div>
        {% endif %}
        <form method="POST" action="/admin/login">
            <label>Campus Transport System-Admin Login</label>
            <input name="institute_name" placeholder="E.g. Your Institute" value="{{ institute_name | default('') }}">

            <label>Admin Username</label>
            <input name="username" placeholder="admin" required>

            <label>Password</label>
            <div style="display:flex; gap:8px; align-items:center">
                <input id="loginPassword" name="password" type="password" placeholder="Enter password" required style="flex:1">
                <button type="button" onclick="toggleVisibility('loginPassword', this)" style="margin-top:0;background:#667eea;color:#fff">Show</button>
            </div>

            <div id="signup-fields" style="display: none;">
                <label>6-digit Signup Pin</label>
                <div style="display:flex; gap:8px; align-items:center">
                    <input id="signupPin" name="signup_pin" type="password" maxlength="6" placeholder="Enter 6-digit pin" style="flex:1">
                    <button type="button" onclick="toggleVisibility('signupPin', this)" style="margin-top:0;background:#667eea;color:#fff">Show</button>
                </div>
            </div>
            <input type="hidden" name="action" id="actionField" value="login">
            <button type="button" onclick="submitLogin()">Login</button>
            <button type="button" id="createBtn" onclick="submitSignup()">Create Account</button>
        </form>
        <script>
        function toggleVisibility(inputId, btn){
            const el = document.getElementById(inputId);
            if(!el) return;
            const isPwd = el.type === 'password';
            el.type = isPwd ? 'text' : 'password';
            if(btn) btn.textContent = isPwd ? 'Hide' : 'Show';
        }
        function submitLogin(){
            document.getElementById('actionField').value = 'login';
            document.querySelector('form').submit();
        }
        function submitSignup(){
            const fields = document.getElementById('signup-fields');
            const pinInput = document.getElementById('signupPin');
            // First click: reveal pin field
            if(fields.style.display === 'none'){
                fields.style.display = 'block';
                return;
            }
            // Require pin before submitting
            if(!pinInput || !pinInput.value.trim()){
                alert('Enter the 6-digit signup pin');
                pinInput && pinInput.focus();
                return;
            }
            document.getElementById('actionField').value = 'signup';
            document.querySelector('form').submit();
        }
        </script>

        <div class="note" style="margin-top:12px">
            
        </div>
    </div>
</body>
</html>
